{% extends "base.html" %}
{% load static %}

{% block title %}Order #{{ order.id }} - GiftNest{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="py-5 bg-gradient-primary text-white">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="hero-title mb-3">
                    <i class="fas fa-receipt me-3"></i>Order #{{ order.id }}
                </h1>
                <p class="hero-subtitle">Track your order and view all details</p>
            </div>
            <div class="col-lg-4 text-end">
                <div class="order-status">
                    {% if order.paid %}
                        <span class="badge bg-success fs-5 px-3 py-2">
                            <i class="fas fa-check-circle me-2"></i>Paid
                        </span>
                    {% else %}
                        <span class="badge bg-warning fs-5 px-3 py-2">
                            <i class="fas fa-clock me-2"></i>Pending Payment
                        </span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Order Content -->
<section class="py-5">
    <div class="container">
        <div class="row g-4">
            <!-- Order Information -->
            <div class="col-lg-8">
                <div class="card order-card">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h3 class="card-title mb-0">
                                <i class="fas fa-info-circle me-2"></i>Order Information
                            </h3>
                            <span class="badge bg-primary">Order #{{ order.id }}</span>
        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="info-item">
                                    <div class="info-icon">
                                        <i class="fas fa-calendar"></i>
                                    </div>
                                    <div class="info-content">
                                        <label>Order Date</label>
                                        <p>{{ order.created|date:"F j, Y" }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-item">
                                    <div class="info-icon">
                                        <i class="fas fa-dollar-sign"></i>
                                    </div>
                                    <div class="info-content">
                                        <label>Total Amount</label>
                                        <p>${{ order.get_total_cost }}</p>
                                    </div>
                                </div>
                            </div>
            </div>
            </div>
        </div>

                <!-- Shipping Information -->
                <div class="card shipping-card mt-4">
                    <div class="card-body p-4">
                        <h4 class="card-title mb-4">
                            <i class="fas fa-shipping-fast me-2"></i>Shipping Information
                        </h4>
                        
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="info-item">
                                    <div class="info-icon">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="info-content">
                                        <label>Recipient Name</label>
                                        <p>{{ order.first_name }} {{ order.last_name }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-item">
                                    <div class="info-icon">
                                        <i class="fas fa-envelope"></i>
                                    </div>
                                    <div class="info-content">
                                        <label>Email Address</label>
                                        <p>{{ order.email }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="info-item">
                                    <div class="info-icon">
                                        <i class="fas fa-map-marker-alt"></i>
                                    </div>
                                    <div class="info-content">
                                        <label>Shipping Address</label>
                                        <p>{{ order.address }}<br>{{ order.city }}, {{ order.postal_code }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>

                <!-- Order Items -->
                <div class="card items-card mt-4">
                    <div class="card-body p-4">
                        <h4 class="card-title mb-4">
                            <i class="fas fa-shopping-bag me-2"></i>Order Items
                        </h4>
                        
                        <div class="order-items">
                            {% for item in order.items.all %}
                                <div class="order-item">
                                    <div class="item-image">
                                        {% if item.product.image %}
                                            <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
                                        {% else %}
                                            <div class="placeholder-image">
                                                <i class="fas fa-gift"></i>
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="item-details">
                                        <h6 class="item-name">{{ item.product.name }}</h6>
                                        <p class="item-description">{{ item.product.description|truncatewords:10 }}</p>
                                        <div class="item-meta">
                                            <span class="item-price">${{ item.price }} each</span>
                                            <span class="item-quantity">Qty: {{ item.quantity }}</span>
                                        </div>
                                    </div>
                                    <div class="item-total">
                                        <span class="total-price">${{ item.get_cost }}</span>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>

                        <div class="order-total">
                            <div class="total-row">
                                <span>Subtotal</span>
                                <span>${{ order.get_total_cost }}</span>
                            </div>
                            <div class="total-row">
                                <span>Shipping</span>
                                <span class="text-success">Free</span>
                            </div>
                            <div class="total-row">
                                <span>Tax</span>
                                <span>$0.00</span>
                            </div>
                            <hr>
                            <div class="total-row final">
                                <span>Total</span>
                                <span>${{ order.get_total_cost }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Order Status & Actions -->
            <div class="col-lg-4">
                <div class="card status-card">
                    <div class="card-body p-4">
                        <h4 class="card-title mb-4">
                            <i class="fas fa-tasks me-2"></i>Order Status
                        </h4>

                        <div class="status-timeline">
                            <div class="status-step completed">
                                <div class="step-icon">
                                    <i class="fas fa-check"></i>
                                </div>
                                <div class="step-content">
                                    <h6>Order Placed</h6>
                                    <p>{{ order.created|date:"M j, Y" }}</p>
                                </div>
                            </div>
                            
                            <div class="status-step {% if order.paid %}completed{% else %}current{% endif %}">
                                <div class="step-icon">
                                    {% if order.paid %}
                                        <i class="fas fa-check"></i>
                                    {% else %}
                                        <i class="fas fa-clock"></i>
                                    {% endif %}
                                </div>
                                <div class="step-content">
                                    <h6>Payment</h6>
                                    <p>{% if order.paid %}Completed{% else %}Pending{% endif %}</p>
                                </div>
                            </div>
                            
                            <div class="status-step">
                                <div class="step-icon">
                                    <i class="fas fa-box"></i>
                                </div>
                                <div class="step-content">
                                    <h6>Processing</h6>
                                    <p>Preparing your order</p>
                                </div>
                            </div>
                            
                            <div class="status-step">
                                <div class="step-icon">
                                    <i class="fas fa-shipping-fast"></i>
                                </div>
                                <div class="step-content">
                                    <h6>Shipped</h6>
                                    <p>On its way to you</p>
                                </div>
                            </div>
                            
                            <div class="status-step">
                                <div class="step-icon">
                                    <i class="fas fa-home"></i>
                                </div>
                                <div class="step-content">
                                    <h6>Delivered</h6>
                                    <p>Arrived at destination</p>
                                </div>
                            </div>
                        </div>

                        {% if not order.paid %}
                            <div class="payment-actions mt-4">
                                <a href="{% url 'payment:process' order.id %}" class="btn btn-primary w-100 mb-3">
                                    <i class="fas fa-credit-card me-2"></i>Complete Payment
                                </a>
                            </div>
                        {% endif %}

                        <div class="order-actions mt-4">
                            <a href="{% url 'products:product_list' %}" class="btn btn-outline-primary w-100 mb-2">
                                <i class="fas fa-shopping-bag me-2"></i>Continue Shopping
                            </a>
                            <a href="{% url 'users:profile' %}" class="btn btn-outline-secondary w-100">
                                <i class="fas fa-user me-2"></i>View All Orders
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Support Card -->
                <div class="card support-card mt-4">
                    <div class="card-body p-4">
                        <h4 class="card-title mb-4">
                            <i class="fas fa-headset me-2"></i>Need Help?
                        </h4>
                        
                        <div class="support-options">
                            <a href="mailto:support@giftnest.com" class="support-option">
                                <i class="fas fa-envelope"></i>
                                <span>Email Support</span>
                            </a>
                            <a href="tel:+1234567890" class="support-option">
                                <i class="fas fa-phone"></i>
                                <span>Call Us</span>
                            </a>
                            <a href="https://giftnest.com/support" class="support-option">
                                <i class="fas fa-comments"></i>
                                <span>Live Chat</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
/* Order Cards */
.order-card,
.shipping-card,
.items-card,
.status-card,
.support-card {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-lg);
    animation: slideInUp 0.6s ease-out;
}

/* Info Items */
.info-item {
    display: flex;
    align-items: flex-start;
    margin-bottom: 1.5rem;
    padding: 1rem;
    border-radius: var(--border-radius);
    transition: all 0.3s ease;
}

.info-item:hover {
    background: rgba(99, 102, 241, 0.1);
    transform: translateX(5px);
}

.info-icon {
    width: 40px;
    height: 40px;
    background: var(--gradient-primary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 1rem;
    flex-shrink: 0;
}

.info-icon i {
    color: white;
    font-size: 1rem;
}

.info-content label {
    font-size: 0.8rem;
    color: var(--gray-600);
    margin-bottom: 0.25rem;
    display: block;
}

.info-content p {
    margin-bottom: 0;
    font-weight: 500;
    color: var(--gray-800);
}

/* Order Items */
.order-item {
    display: flex;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 1px solid var(--gray-200);
    transition: all 0.3s ease;
}

.order-item:last-child {
    border-bottom: none;
}

.order-item:hover {
    background: rgba(99, 102, 241, 0.05);
    border-radius: var(--border-radius);
}

.item-image {
    width: 80px;
    height: 80px;
    border-radius: var(--border-radius);
    overflow: hidden;
    margin-right: 1.5rem;
    background: var(--gray-100);
    display: flex;
    align-items: center;
    justify-content: center;
}

.item-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.placeholder-image {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--gray-400);
    font-size: 1.5rem;
}

.item-details {
    flex: 1;
}

.item-name {
    margin-bottom: 0.5rem;
    color: var(--gray-800);
    font-weight: 600;
}

.item-description {
    margin-bottom: 0.5rem;
    color: var(--gray-600);
    font-size: 0.9rem;
}

.item-meta {
    display: flex;
    gap: 1rem;
    font-size: 0.9rem;
}

.item-price {
    color: var(--gray-600);
}

.item-quantity {
    color: var(--gray-600);
}

.item-total {
    text-align: right;
}

.total-price {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--primary-color);
}

/* Order Total */
.order-total {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 2px solid var(--gray-200);
}

.total-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 1rem;
    color: var(--gray-700);
}

.total-row.final {
    font-size: 1.3rem;
    font-weight: 600;
    color: var(--gray-800);
    margin-top: 1.5rem;
}

/* Status Timeline */
.status-timeline {
    position: relative;
}

.status-timeline::before {
    content: '';
    position: absolute;
    left: 20px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: var(--gray-300);
}

.status-step {
    display: flex;
    align-items: flex-start;
    margin-bottom: 2rem;
    position: relative;
}

.status-step:last-child {
    margin-bottom: 0;
}

.step-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 1rem;
    background: var(--gray-200);
    color: var(--gray-600);
    z-index: 1;
}

.status-step.completed .step-icon {
    background: var(--gradient-primary);
    color: white;
}

.status-step.current .step-icon {
    background: var(--gradient-warning);
    color: white;
}

.step-content h6 {
    margin-bottom: 0.25rem;
    color: var(--gray-800);
    font-weight: 600;
}

.step-content p {
    margin-bottom: 0;
    color: var(--gray-600);
    font-size: 0.9rem;
}

/* Support Options */
.support-option {
    display: flex;
    align-items: center;
    padding: 1rem;
    border-radius: var(--border-radius);
    text-decoration: none;
    color: var(--gray-700);
    transition: all 0.3s ease;
    margin-bottom: 0.5rem;
}

.support-option:hover {
    background: rgba(99, 102, 241, 0.1);
    color: var(--primary-color);
    transform: translateX(5px);
}

.support-option i {
    margin-right: 1rem;
    font-size: 1.2rem;
    width: 20px;
    text-align: center;
}

/* Animations */
@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Responsive */
@media (max-width: 768px) {
    .order-card,
    .shipping-card,
    .items-card,
    .status-card,
    .support-card {
        margin-bottom: 2rem;
    }
    
    .info-item {
        flex-direction: column;
        text-align: center;
    }
    
    .info-icon {
        margin-right: 0;
        margin-bottom: 1rem;
    }
    
    .order-item {
        flex-direction: column;
        text-align: center;
    }
    
    .item-image {
        margin-right: 0;
        margin-bottom: 1rem;
    }
    
    .item-total {
        text-align: center;
        margin-top: 1rem;
    }
}
</style>
{% endblock %}
