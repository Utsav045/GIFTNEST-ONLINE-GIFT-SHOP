{% load static %}
<nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'products:product_list' %}">Products</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ product.name }}</li>
    </ol>
</nav>
<div class="row">
    <div class="col-md-6">
        {% if product.image %}
            <img src="{{ product.image.url }}" class="img-fluid rounded product-image" alt="{{ product.name }}">
        {% else %}
            <img src="https://images.unsplash.com/photo-1549465220-1a8b9238cd48?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80" class="img-fluid rounded product-image" alt="{{ product.name }}">
        {% endif %}
    </div>
    <div class="col-md-6">
        <h1 class="mb-3">{{ product.name }}</h1>
        <div class="mb-4">
            <span class="h3 text-primary">${{ product.price }}</span>
            {% if product.stock > 0 %}
                <span class="badge bg-success ms-2">In Stock</span>
            {% else %}
                <span class="badge bg-danger ms-2">Out of Stock</span>
            {% endif %}
        </div>
        <div class="mb-4">
            <h5>Description</h5>
            <p class="text-muted">{{ product.description }}</p>
        </div>
        {% if product.stock > 0 %}
            <form action="{% url 'cart:cart_add' product.id %}" method="post" class="mb-4">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="quantity" class="form-label">Quantity</label>
                    <div class="input-group">
                        <button type="button" class="btn btn-outline-secondary" onclick="decrementQuantity()">-</button>
                        <input type="number" id="quantity" name="quantity" value="1" min="1" 
                               max="{{ product.stock }}" class="form-control text-center" required>
                        <button type="button" class="btn btn-outline-secondary" onclick="incrementQuantity()">+</button>
                    </div>
                    <small class="text-muted">{{ product.stock }} available</small>
                </div>
                <button type="submit" class="btn btn-primary btn-lg w-100">Add to Cart</button>
            </form>
        {% else %}
            <div class="alert alert-warning">
                This item is currently out of stock. Please check back later.
            </div>
        {% endif %}
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Product Details</h5>
                <ul class="list-unstyled mb-0">
                    <li><strong>SKU:</strong> {{ product.id }}</li>
                    <li><strong>Added:</strong> {{ product.created|date:"F j, Y" }}</li>
                    <li><strong>Last Updated:</strong> {{ product.updated|date:"F j, Y" }}</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% if related_products %}
<div class="mt-5">
    <h3 class="mb-4">Related Products</h3>
    <div class="row row-cols-1 row-cols-md-4 g-4">
        {% for related in related_products %}
            <div class="col">
                <div class="card h-100">
                    {% if related.image %}
                        <img src="{{ related.image.url }}" class="card-img-top" alt="{{ related.name }}">
                    {% endif %}
                    <div class="card-body">
                        <h5 class="card-title">{{ related.name }}</h5>
                        <p class="card-text">
                            <strong>${{ related.price }}</strong>
                        </p>
                        <a href="{{ related.get_absolute_url }}" class="btn btn-outline-primary">View Details</a>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>
{% endif %}
<script>
function decrementQuantity() {
    const input = document.getElementById('quantity');
    const currentValue = parseInt(input.value);
    if (currentValue > 1) {
        input.value = currentValue - 1;
    }
}
function incrementQuantity() {
    const input = document.getElementById('quantity');
    const currentValue = parseInt(input.value);
    const maxValue = parseInt(input.getAttribute('max'));
    if (currentValue < maxValue) {
        input.value = currentValue + 1;
    }
}
document.getElementById('quantity').addEventListener('change', function() {
    const value = parseInt(this.value);
    const max = parseInt(this.getAttribute('max'));
    const min = parseInt(this.getAttribute('min'));
    if (value > max) {
        this.value = max;
    }
    if (value < min) {
        this.value = min;
    }
});
</script>